###
# Bayes-Adaptive LLM config for persuasion (P4G).
# Designed to run SFT on the P4G dataset and then DPO on preference pairs.
###

# Backbone (reduced for 8GB GPU)
tokenizer: roberta-base
plm: roberta-base
lm_size: 768
cached_dir: "cache/BAYES/"
dropout: 0.1
combined_action: false

# Training toggles
run_preference_search: true   # MCTS preference search handled separately
run_sft: false
run_dpo: false
run_offline_eval: false
run_online_eval: false

# SFT hyperparameters (memory-friendly)
batch_size: 1
gradient_accumulation: 4
learning_rate: 3e-5
warmup_ratio: 0.05
weight_decay: 0.01
num_train_epochs: 3
logging_steps: 10
save_total_limit: 2
max_grad_norm: 1.0
max_sequence_length: 256

# DPO-specific
dpo_beta: 0.1
max_length: 256
max_prompt_length: 256
fp16: true
bf16: false
gradient_checkpointing: true
# Path to preference pairs (jsonl) used for DPO; dataset/loader should read this.
preference_pairs_path: "data/preference_pairs_gpt-3.5-turbo.jsonl"

# Generation
temperature: 0.7
max_gen_tokens: 64

# Prompt scaffolds for persuasion (override as needed)
persuader_prompt: |
  The following is background information about Save the Children.
  Save the Children is head-quartered in London, and they work to help fight poverty around the world.
  Children need help in developing countries and war zones. Small donations like $1 or $2 go a long way to help.
  The following is an example conversation between a Persuader and a Persuadee about a charity called Save the Children.
  The Persuader is trying to persuade the Persuadee to donate to Save the Children.
persuader_response_instruction: "Respond politely with at least one complete sentence that advances the persuasion objective."
persuadee_prompt: |
  Context:
  - Save the Children is a global charity that provides safety, nutrition, education, and emergency relief for vulnerable children.
  - Donations of any size (as little as $1 or $2) can meaningfully improve children’s lives in developing regions and crisis zones.

  Role:
  - You are the Persuadee. The Persuader is trying to convince you to donate to Save the Children.

  Guidelines:
  1. Evaluate each request objectively and ask for clarification when details are unclear.
  2. Think about how the Persuader’s message resonates with your values and priorities before deciding what feels right for you.
  3. Respond politely, using complete sentences that add substance to the conversation (never empty or meaningless).
  4. Always respond in the format `[dialog_act] utterance`, where `dialog_act` is one of the allowed persuadee acts.
  5. Choose the dialog act that best reflects your genuine reaction; take action `[donate]` only when sufficiently convinced.

# Special tokens for persuasion (same as TRIP/PPDPP PG)
special_tokens_dict:
  pad_token: "<pad>"
  cls_token: "<cls>"
  sep_token: "<sep>"
  additional_special_tokens:
    - "[PERSUADER]"
    - "[PERSUADEE]"
    - "[PATH]"
    - "[SEP]"
    - "[CONTEXT]"
    - "[GOAL]"
